<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Yalanamchou</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --black: #000000;
  --white: #FFFFFF;
  --gray-50: #F8F8F8;
  --gray-100: #F0F0F0;
  --gray-200: #E0E0E0;
  --gray-400: #9E9E9E;
  --gray-600: #5E5E5E;
  --rouge: #C8102E;
  --jaune: #F5A623;
  --vert: #2ECC71;
  --font: 'Plus Jakarta Sans', sans-serif;
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { height: 100%; }
body {
  font-family: var(--font); background: var(--black);
  height: 100%; overflow: hidden; color: var(--black);
  -webkit-font-smoothing: antialiased;
}

/* ========== SCREENS ========== */
.screen {
  position: fixed; inset: 0; display: none;
  flex-direction: column; background: var(--white);
}
.screen.show { display: flex; }

/* ========== SPLASH ========== */
#splash {
  background: var(--black);
  align-items: center; justify-content: center;
}
.splash-inner { text-align: center; }
.splash-car {
  font-size: 80px; display: block;
  animation: splashBounce 0.8s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes splashBounce { from { transform: scale(0) translateY(30px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
.splash-title {
  font-size: 42px; font-weight: 900; color: var(--white);
  letter-spacing: -1px; margin-top: 20px;
  animation: fadeUp 0.6s ease 0.4s both;
}
.splash-sub {
  font-size: 16px; color: var(--gray-400); margin-top: 8px;
  animation: fadeUp 0.6s ease 0.6s both;
}
.splash-bar {
  width: 48px; height: 4px; background: rgba(255,255,255,0.1);
  border-radius: 2px; margin: 48px auto 0; overflow: hidden;
  animation: fadeUp 0.6s ease 0.8s both;
}
.splash-bar-fill {
  height: 100%; background: var(--white); border-radius: 2px;
  animation: fillBar 2.4s ease forwards;
}
@keyframes fillBar { from { width: 0; } to { width: 100%; } }
@keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

/* ========== LOGIN ========== */
#login { background: var(--black); justify-content: flex-end; }
.login-hero {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center; padding: 40px 32px;
}
.login-logo {
  font-size: 36px; font-weight: 900; color: var(--white);
  letter-spacing: -1.5px; text-align: center; margin-bottom: 12px;
}
.login-tagline { font-size: 15px; color: var(--gray-400); text-align: center; }
.login-card {
  background: var(--white); border-radius: 28px 28px 0 0;
  padding: 32px 24px 40px; animation: slideUp 0.5s cubic-bezier(0.32,0.72,0,1);
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.login-card-title { font-size: 24px; font-weight: 800; margin-bottom: 6px; letter-spacing: -0.5px; }
.login-card-sub { font-size: 14px; color: var(--gray-400); margin-bottom: 24px; }
.phone-row { display: flex; gap: 10px; margin-bottom: 16px; }
.code-btn {
  padding: 0 18px; height: 58px; background: var(--gray-50);
  border: 1.5px solid var(--gray-200); border-radius: 16px;
  font-family: var(--font); font-size: 16px; font-weight: 700;
  color: var(--black); display: flex; align-items: center; gap: 6px; flex-shrink: 0;
}
.phone-field {
  flex: 1; height: 58px; background: var(--gray-50);
  border: 1.5px solid var(--gray-200); border-radius: 16px;
  padding: 0 18px; font-family: var(--font); font-size: 18px;
  font-weight: 600; color: var(--black); outline: none; transition: border-color 0.2s;
}
.phone-field:focus { border-color: var(--black); background: var(--white); }
.btn-cta {
  width: 100%; height: 58px; background: var(--black); color: var(--white);
  border: none; border-radius: 16px; font-family: var(--font);
  font-size: 17px; font-weight: 800; cursor: pointer; letter-spacing: -0.3px;
  transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-cta:active { transform: scale(0.97); }
.btn-cta.red { background: var(--rouge); }
.btn-cta.green { background: var(--vert); }
.terms-txt { font-size: 12px; color: var(--gray-400); text-align: center; margin-top: 16px; line-height: 1.6; }
.terms-txt u { color: var(--gray-600); }

/* OTP */
.otp-hint { font-size: 14px; color: var(--gray-400); margin-bottom: 24px; }
.otp-hint span { color: var(--black); font-weight: 700; }
.otp-grid { display: flex; gap: 8px; margin-bottom: 24px; }
.otp-box {
  flex: 1; height: 64px; text-align: center; font-size: 28px; font-weight: 800;
  background: var(--gray-50); border: 2px solid var(--gray-200);
  border-radius: 14px; font-family: var(--font); color: var(--black);
  outline: none; transition: all 0.15s; caret-color: var(--rouge);
}
.otp-box:focus { border-color: var(--black); background: var(--white); transform: scale(1.04); }
.otp-box.done { border-color: var(--black); color: var(--black); }
.resend-row { text-align: center; margin-top: 16px; }
.resend-link { font-size: 14px; font-weight: 700; color: var(--black); cursor: pointer; text-decoration: underline; }

/* ========== HOME ========== */
#home { background: var(--gray-50); }
.home-header {
  background: var(--white); padding: 18px 20px 16px;
  border-bottom: 1px solid var(--gray-100);
  display: flex; align-items: center; justify-content: space-between;
}
.header-logo { font-size: 22px; font-weight: 900; letter-spacing: -1px; color: var(--black); }
.header-right { display: flex; align-items: center; gap: 10px; }
.notif-btn {
  width: 40px; height: 40px; border-radius: 50%; background: var(--gray-50);
  border: none; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;
}
.avatar-btn {
  width: 40px; height: 40px; border-radius: 50%;
  background: var(--black); color: var(--white);
  font-size: 16px; font-weight: 800; border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}

.home-scroll { flex: 1; overflow-y: auto; padding-bottom: 88px; }
.home-scroll::-webkit-scrollbar { display: none; }

/* WHERE TO CARD */
.where-card {
  margin: 16px; background: var(--white); border-radius: 20px;
  padding: 6px; box-shadow: 0 2px 20px rgba(0,0,0,0.06);
}
.where-row {
  display: flex; align-items: center; gap: 14px;
  padding: 14px 16px; cursor: pointer; border-radius: 14px; transition: background 0.15s;
}
.where-row:hover { background: var(--gray-50); }
.where-pip { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.where-pip.from { background: var(--black); }
.where-pip.to { background: var(--rouge); }
.where-line { height: 1px; background: var(--gray-100); margin: 0 16px; }
.where-label { font-size: 16px; font-weight: 600; flex: 1; }
.where-label.muted { color: var(--gray-400); font-weight: 500; }
.where-arrow { font-size: 20px; color: var(--gray-400); }

/* GREETING */
.greeting-wrap { padding: 8px 20px 16px; }
.greeting-txt { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; color: var(--black); }
.greeting-sub { font-size: 14px; color: var(--gray-400); margin-top: 3px; }

/* PROMO */
.promo-card {
  margin: 0 16px 20px; border-radius: 20px; overflow: hidden;
  background: var(--black); padding: 22px 24px; position: relative;
}
.promo-card::before {
  content: ''; position: absolute; right: -20px; top: -20px;
  width: 120px; height: 120px; border-radius: 50%;
  background: rgba(255,255,255,0.04);
}
.promo-pill {
  display: inline-block; background: var(--jaune); color: var(--black);
  font-size: 11px; font-weight: 800; padding: 4px 10px; border-radius: 20px;
  margin-bottom: 10px; letter-spacing: 0.5px;
}
.promo-title { font-size: 20px; font-weight: 800; color: var(--white); letter-spacing: -0.5px; margin-bottom: 4px; }
.promo-sub { font-size: 13px; color: rgba(255,255,255,0.45); }
.promo-emoji { position: absolute; right: 24px; top: 50%; transform: translateY(-50%); font-size: 52px; opacity: 0.25; }

/* SECTION */
.section-head { display: flex; align-items: center; justify-content: space-between; padding: 0 20px; margin-bottom: 12px; }
.section-title { font-size: 17px; font-weight: 800; letter-spacing: -0.3px; }
.section-link { font-size: 14px; font-weight: 700; color: var(--gray-400); cursor: pointer; }

/* QUICK SCROLL */
.quick-scroll { display: flex; gap: 10px; padding: 0 16px; overflow-x: auto; margin-bottom: 24px; }
.quick-scroll::-webkit-scrollbar { display: none; }
.quick-chip {
  display: flex; align-items: center; gap: 10px;
  background: var(--white); border-radius: 50px; padding: 12px 18px;
  white-space: nowrap; cursor: pointer; flex-shrink: 0;
  box-shadow: 0 1px 8px rgba(0,0,0,0.06); transition: all 0.2s;
  border: 1.5px solid transparent;
}
.quick-chip:hover { border-color: var(--black); }
.quick-chip:active { transform: scale(0.96); }
.chip-icon { font-size: 20px; }
.chip-name { font-size: 14px; font-weight: 700; }
.chip-dist { font-size: 12px; color: var(--gray-400); margin-top: 1px; }

/* RECENT */
.recent-list { padding: 0 16px; }
.recent-card {
  background: var(--white); border-radius: 16px;
  padding: 16px; margin-bottom: 10px; display: flex; align-items: center; gap: 14px;
  cursor: pointer; transition: all 0.2s; box-shadow: 0 1px 8px rgba(0,0,0,0.04);
}
.recent-card:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
.recent-card:active { transform: scale(0.98); }
.recent-icon {
  width: 48px; height: 48px; border-radius: 14px; background: var(--gray-50);
  display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;
}
.recent-name { font-size: 15px; font-weight: 700; letter-spacing: -0.2px; }
.recent-meta { font-size: 13px; color: var(--gray-400); margin-top: 3px; }
.recent-price { font-size: 15px; font-weight: 800; color: var(--black); }
.recent-arrow { font-size: 18px; color: var(--gray-200); }

/* BOTTOM NAV */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; height: 80px;
  background: var(--white); border-top: 1px solid var(--gray-100);
  display: flex; align-items: center; z-index: 200;
  padding-bottom: env(safe-area-inset-bottom);
}
.nav-item {
  flex: 1; display: flex; flex-direction: column; align-items: center;
  gap: 4px; cursor: pointer; padding: 8px 0; transition: all 0.2s;
}
.nav-item:active { transform: scale(0.9); }
.nav-ico { font-size: 24px; }
.nav-lbl { font-size: 11px; font-weight: 700; color: var(--gray-400); letter-spacing: 0.3px; }
.nav-item.on .nav-lbl { color: var(--black); }
.nav-item.on .nav-ico { filter: none; }

/* ========== BOOKING ========== */
#booking { background: var(--white); }
.booking-top {
  padding: 16px 20px; display: flex; align-items: center; gap: 14px;
  border-bottom: 1px solid var(--gray-100);
}
.back-circle {
  width: 42px; height: 42px; border-radius: 50%; background: var(--gray-50);
  border: none; cursor: pointer; font-size: 20px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; transition: all 0.15s;
}
.back-circle:active { background: var(--gray-200); }
.booking-inputs { flex: 1; }
.b-inp-wrap { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
.b-inp-wrap + .b-inp-wrap { border-top: 1px solid var(--gray-100); }
.b-pip { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.b-inp {
  flex: 1; border: none; outline: none; font-family: var(--font);
  font-size: 16px; font-weight: 600; color: var(--black); background: transparent;
}
.b-inp::placeholder { color: var(--gray-400); font-weight: 500; }
.booking-scroll { flex: 1; overflow-y: auto; }
.booking-scroll::-webkit-scrollbar { display: none; }
.sugg-head { font-size: 12px; font-weight: 700; color: var(--gray-400); text-transform: uppercase; letter-spacing: 1px; padding: 20px 20px 10px; }
.sugg-item {
  display: flex; align-items: center; gap: 14px;
  padding: 14px 20px; cursor: pointer; transition: background 0.15s;
}
.sugg-item:hover { background: var(--gray-50); }
.sugg-item:active { background: var(--gray-100); }
.sugg-ico {
  width: 44px; height: 44px; border-radius: 14px; background: var(--gray-100);
  display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0;
}
.sugg-name { font-size: 15px; font-weight: 700; letter-spacing: -0.2px; }
.sugg-sub { font-size: 13px; color: var(--gray-400); margin-top: 2px; }
.sugg-km { font-size: 13px; color: var(--gray-400); margin-left: auto; flex-shrink: 0; }
.sugg-div { height: 1px; background: var(--gray-100); margin: 0 20px; }

/* ========== VEHICLES ========== */
#vehicles { background: var(--white); }
.vehicle-map {
  height: 200px; background: #0a0f1e; overflow: hidden; position: relative; flex-shrink: 0;
}
.vehicle-map canvas { width: 100%; height: 100%; display: block; }
.vehicle-dest-label {
  position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);
  background: var(--white); padding: 8px 18px; border-radius: 24px;
  font-size: 13px; font-weight: 700; box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  white-space: nowrap;
}
.vehicles-scroll { flex: 1; overflow-y: auto; padding: 16px 16px 0; }
.vehicles-scroll::-webkit-scrollbar { display: none; }
.vehicle-card {
  display: flex; align-items: center; gap: 14px;
  padding: 18px 16px; border-radius: 18px; margin-bottom: 10px;
  border: 2px solid var(--gray-100); cursor: pointer; transition: all 0.2s;
  background: var(--white);
}
.vehicle-card.sel { border-color: var(--black); background: var(--black); }
.vehicle-card:active { transform: scale(0.98); }
.v-emoji { font-size: 42px; width: 56px; text-align: center; flex-shrink: 0; }
.v-info { flex: 1; }
.v-name { font-size: 16px; font-weight: 800; letter-spacing: -0.3px; }
.v-desc { font-size: 13px; margin-top: 2px; }
.v-eta { display: inline-block; font-size: 12px; font-weight: 700; margin-top: 6px; padding: 3px 10px; border-radius: 20px; }
.v-right { text-align: right; }
.v-price { font-size: 22px; font-weight: 900; letter-spacing: -0.5px; }
.v-fcfa { font-size: 12px; margin-top: 2px; }
/* Default colors */
.vehicle-card .v-name, .vehicle-card .v-desc, .vehicle-card .v-fcfa { color: var(--black); }
.vehicle-card .v-desc { color: var(--gray-400); }
.vehicle-card .v-eta { background: rgba(46,204,113,0.1); color: #16A34A; }
.vehicle-card .v-price { color: var(--black); }
.vehicle-card .v-fcfa { color: var(--gray-400); }
/* Selected state */
.vehicle-card.sel .v-name, .vehicle-card.sel .v-price { color: var(--white); }
.vehicle-card.sel .v-desc, .vehicle-card.sel .v-fcfa { color: rgba(255,255,255,0.5); }
.vehicle-card.sel .v-eta { background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.9); }
/* Bottom confirm */
.v-confirm {
  padding: 16px 16px 32px; border-top: 1px solid var(--gray-100);
  background: var(--white);
}
.v-confirm-row { display: flex; justify-content: space-between; margin-bottom: 14px; }
.v-confirm-lbl { font-size: 14px; color: var(--gray-400); font-weight: 500; }
.v-confirm-val { font-size: 15px; font-weight: 800; }

/* ========== TRACKING ========== */
#tracking { background: var(--white); }
.track-map { height: 42vh; background: #0a0f1e; flex-shrink: 0; position: relative; overflow: hidden; }
.track-map canvas { width: 100%; height: 100%; display: block; }
.track-sheet {
  flex: 1; overflow-y: auto; padding: 0 20px 32px;
  border-radius: 28px 28px 0 0; background: var(--white);
  margin-top: -28px; position: relative; z-index: 10;
}
.track-sheet::-webkit-scrollbar { display: none; }
.track-handle { width: 40px; height: 4px; background: var(--gray-200); border-radius: 2px; margin: 16px auto 20px; }
.track-status {
  text-align: center; padding: 20px; background: var(--gray-50);
  border-radius: 18px; margin-bottom: 16px;
}
.track-status-title { font-size: 22px; font-weight: 900; letter-spacing: -0.5px; margin-bottom: 4px; }
.track-status-sub { font-size: 14px; color: var(--gray-400); }
.track-eta-row { display: flex; gap: 10px; margin-bottom: 16px; }
.track-eta-box {
  flex: 1; background: var(--gray-50); border-radius: 16px;
  padding: 16px; text-align: center;
}
.track-eta-num { font-size: 30px; font-weight: 900; letter-spacing: -1px; }
.track-eta-lbl { font-size: 11px; font-weight: 700; color: var(--gray-400); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
.track-prog { height: 4px; background: var(--gray-100); border-radius: 2px; margin-bottom: 20px; overflow: hidden; }
.track-prog-fill { height: 100%; background: var(--black); border-radius: 2px; transition: width 0.6s ease; }
.driver-block {
  display: flex; align-items: center; gap: 14px;
  background: var(--gray-50); border-radius: 18px; padding: 16px; margin-bottom: 14px;
}
.driver-ava {
  width: 60px; height: 60px; border-radius: 50%;
  background: var(--black); display: flex; align-items: center;
  justify-content: center; font-size: 30px; flex-shrink: 0;
}
.driver-n { font-size: 18px; font-weight: 800; letter-spacing: -0.3px; }
.driver-car-info { font-size: 13px; color: var(--gray-400); margin-top: 3px; }
.driver-pl {
  display: inline-block; background: var(--jaune); color: var(--black);
  font-size: 11px; font-weight: 900; padding: 3px 10px; border-radius: 6px; margin-top: 6px;
  letter-spacing: 0.5px;
}
.driver-rating { margin-left: auto; text-align: center; }
.driver-stars { font-size: 14px; color: var(--jaune); }
.driver-num { font-size: 22px; font-weight: 900; letter-spacing: -0.5px; }
.track-btns { display: flex; gap: 10px; }
.btn-outline {
  flex: 1; height: 52px; border: 2px solid var(--gray-200);
  border-radius: 14px; background: var(--white); font-family: var(--font);
  font-size: 15px; font-weight: 700; cursor: pointer; color: var(--black); transition: all 0.2s;
}
.btn-outline:active { background: var(--gray-50); }
.btn-outline.danger { border-color: rgba(200,16,46,0.2); color: var(--rouge); }

/* ========== ARRIVED ========== */
#arrived { background: var(--white); align-items: center; justify-content: center; padding: 40px 24px; }
.arrived-anim { font-size: 80px; margin-bottom: 20px; animation: pop 0.5s cubic-bezier(0.34,1.56,0.64,1) both; }
@keyframes pop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.arrived-h { font-size: 30px; font-weight: 900; letter-spacing: -1px; text-align: center; margin-bottom: 6px; }
.arrived-s { font-size: 15px; color: var(--gray-400); text-align: center; margin-bottom: 28px; }
.price-big { font-size: 64px; font-weight: 900; letter-spacing: -3px; text-align: center; line-height: 1; margin-bottom: 4px; }
.price-curr { font-size: 16px; color: var(--gray-400); text-align: center; margin-bottom: 28px; }
.rate-section { width: 100%; margin-bottom: 24px; text-align: center; }
.rate-label { font-size: 14px; color: var(--gray-400); font-weight: 600; margin-bottom: 12px; }
.rate-stars { display: flex; gap: 6px; justify-content: center; }
.rate-star { font-size: 40px; cursor: pointer; transition: all 0.15s; filter: grayscale(1) opacity(0.25); }
.rate-star.on { filter: none; transform: scale(1.15); }
.pay-row { display: flex; gap: 8px; width: 100%; margin-bottom: 20px; }
.pay-btn {
  flex: 1; padding: 14px 8px; border: 2px solid var(--gray-100); border-radius: 14px;
  cursor: pointer; text-align: center; transition: all 0.2s;
}
.pay-btn.on { border-color: var(--black); background: var(--black); }
.pay-btn .p-ico { font-size: 28px; margin-bottom: 4px; }
.pay-btn .p-lbl { font-size: 12px; font-weight: 700; color: var(--black); }
.pay-btn.on .p-lbl { color: var(--white); }

/* ========== PROFILE ========== */
#profile { background: var(--gray-50); overflow-y: auto; padding-bottom: 80px; }
.profile-top {
  background: var(--black); padding: 48px 24px 32px;
  display: flex; flex-direction: column; align-items: center;
}
.profile-ava-big {
  width: 80px; height: 80px; border-radius: 50%; background: var(--white);
  display: flex; align-items: center; justify-content: center;
  font-size: 36px; font-weight: 900; color: var(--black); margin-bottom: 14px;
}
.profile-n { font-size: 24px; font-weight: 900; color: var(--white); letter-spacing: -0.5px; }
.profile-p { font-size: 14px; color: rgba(255,255,255,0.4); margin-top: 4px; }
.stats-row { display: flex; margin: 16px; gap: 10px; }
.stat-card {
  flex: 1; background: var(--white); border-radius: 16px; padding: 16px;
  text-align: center; box-shadow: 0 1px 8px rgba(0,0,0,0.04);
}
.stat-n { font-size: 26px; font-weight: 900; letter-spacing: -1px; }
.stat-l { font-size: 12px; color: var(--gray-400); font-weight: 600; margin-top: 2px; }
.menu-grp { padding: 0 16px; margin-bottom: 14px; }
.menu-grp-title { font-size: 12px; font-weight: 700; color: var(--gray-400); text-transform: uppercase; letter-spacing: 1px; padding: 0 4px; margin-bottom: 8px; }
.menu-row {
  display: flex; align-items: center; gap: 14px;
  background: var(--white); border-radius: 14px; padding: 16px;
  margin-bottom: 6px; cursor: pointer; transition: all 0.2s;
}
.menu-row:active { background: var(--gray-50); }
.menu-ico { font-size: 22px; width: 30px; }
.menu-lbl { font-size: 15px; font-weight: 700; flex: 1; letter-spacing: -0.2px; }
.menu-chev { font-size: 18px; color: var(--gray-200); }
.menu-row.danger .menu-lbl { color: var(--rouge); }

/* ========== TOAST ========== */
.toast {
  position: fixed; top: 20px; left: 50%;
  transform: translateX(-50%) translateY(-80px);
  z-index: 9999; background: var(--black); color: var(--white);
  padding: 14px 24px; border-radius: 50px;
  font-size: 14px; font-weight: 700; letter-spacing: -0.2px;
  white-space: nowrap; opacity: 0;
  transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 8px 32px rgba(0,0,0,0.25);
}
.toast.on { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.green { background: #16A34A; }
.toast.red { background: var(--rouge); }
.toast.blue { background: #2563EB; }
</style>
</head>
<body>

<div class="toast" id="t"></div>

<!-- ====== SPLASH ====== -->
<div class="screen show" id="splash">
  <div class="splash-inner">
    <span class="splash-car">üöï</span>
    <div class="splash-title">Yalanamchou</div>
    <div class="splash-sub">Le taxi intelligent du Tchad</div>
    <div class="splash-bar"><div class="splash-bar-fill"></div></div>
  </div>
</div>

<!-- ====== LOGIN ====== -->
<div class="screen" id="login">
  <div class="login-hero">
    <div style="font-size:64px;margin-bottom:20px">üöï</div>
    <div class="login-logo">Yalanamchou</div>
    <div class="login-tagline">Votre taxi partout √† N'Djam√©na</div>
  </div>
  <!-- Step 1: Phone -->
  <div class="login-card" id="s1">
    <div class="login-card-title">Entrez votre num√©ro</div>
    <div class="login-card-sub">Nous vous enverrons un code de v√©rification</div>
    <div class="phone-row">
      <div class="code-btn">üáπüá© +235</div>
      <input class="phone-field" type="tel" id="ph" placeholder="66 XX XX XX" maxlength="8">
    </div>
    <button class="btn-cta" onclick="doSendOTP()">Continuer ‚Üí</button>
    <div class="terms-txt">En continuant, vous acceptez nos <u>Conditions</u> et <u>Politique de confidentialit√©</u></div>
  </div>
  <!-- Step 2: OTP -->
  <div class="login-card" id="s2" style="display:none">
    <div class="login-card-title">Code de v√©rification</div>
    <div class="otp-hint">Entrez le code envoy√© au <span id="phDisp"></span></div>
    <div class="otp-grid">
      <input class="otp-box" type="tel" maxlength="1" id="o0" oninput="otpIn(this,0)">
      <input class="otp-box" type="tel" maxlength="1" id="o1" oninput="otpIn(this,1)">
      <input class="otp-box" type="tel" maxlength="1" id="o2" oninput="otpIn(this,2)">
      <input class="otp-box" type="tel" maxlength="1" id="o3" oninput="otpIn(this,3)">
      <input class="otp-box" type="tel" maxlength="1" id="o4" oninput="otpIn(this,4)">
      <input class="otp-box" type="tel" maxlength="1" id="o5" oninput="otpIn(this,5)">
    </div>
    <button class="btn-cta green" onclick="doVerifyOTP()">V√©rifier ‚Üí</button>
    <div class="resend-row"><span class="resend-link" onclick="doSendOTP()">Renvoyer le code</span></div>
  </div>
</div>

<!-- ====== HOME ====== -->
<div class="screen" id="home">
  <div class="home-header">
    <div class="header-logo">Yalanamchou</div>
    <div class="header-right">
      <button class="notif-btn">üîî</button>
      <button class="avatar-btn" id="avatarBtn" onclick="go('profile')">M</button>
    </div>
  </div>
  <div class="home-scroll">
    <!-- Greeting -->
    <div class="greeting-wrap" style="padding:16px 20px 12px">
      <div class="greeting-txt" id="greetTxt">Bonjour üëã</div>
      <div class="greeting-sub">üìç March√© Central, N'Djam√©na</div>
    </div>
    <!-- Where to -->
    <div class="where-card" onclick="go('booking')">
      <div class="where-row">
        <div class="where-pip from"></div>
        <div class="where-label muted">O√π voulez-vous aller ?</div>
        <div class="where-arrow">‚Ä∫</div>
      </div>
    </div>
    <!-- Promo -->
    <div class="promo-card" style="margin:16px">
      <div class="promo-pill">üéÅ OFFRE</div>
      <div class="promo-title">Premi√®re course √† -50%</div>
      <div class="promo-sub">Code : YALA2026</div>
      <div class="promo-emoji">üöï</div>
    </div>
    <!-- Quick -->
    <div class="section-head">
      <div class="section-title">Destinations rapides</div>
    </div>
    <div class="quick-scroll">
      <div class="quick-chip" onclick="pick('A√©roport Hassan Djamous',8.2,12)"><div class="chip-icon">‚úàÔ∏è</div><div><div class="chip-name">A√©roport</div><div class="chip-dist">8.2 km</div></div></div>
      <div class="quick-chip" onclick="pick('Universit√© de N\'Djam√©na',4.1,6)"><div class="chip-icon">üéì</div><div><div class="chip-name">Universit√©</div><div class="chip-dist">4.1 km</div></div></div>
      <div class="quick-chip" onclick="pick('H√¥pital G√©n√©ral',5.2,8)"><div class="chip-icon">üè•</div><div><div class="chip-name">H√¥pital</div><div class="chip-dist">5.2 km</div></div></div>
      <div class="quick-chip" onclick="pick('March√© de Demb√©',3.8,6)"><div class="chip-icon">üõí</div><div><div class="chip-name">March√©</div><div class="chip-dist">3.8 km</div></div></div>
      <div class="quick-chip" onclick="pick('Quartier Moursal',2.5,4)"><div class="chip-icon">üèòÔ∏è</div><div><div class="chip-name">Moursal</div><div class="chip-dist">2.5 km</div></div></div>
    </div>
    <!-- Recent -->
    <div class="section-head"><div class="section-title">R√©cents</div></div>
    <div class="recent-list">
      <div class="recent-card" onclick="pick('A√©roport Hassan Djamous',8.2,12)">
        <div class="recent-icon">‚úàÔ∏è</div>
        <div style="flex:1">
          <div class="recent-name">A√©roport Hassan Djamous</div>
          <div class="recent-meta">Hier ‚Ä¢ 8.2 km ‚Ä¢ Mahamat</div>
        </div>
        <div style="text-align:right">
          <div class="recent-price">2 750F</div>
          <div class="recent-arrow">‚Ä∫</div>
        </div>
      </div>
      <div class="recent-card" onclick="pick('Universit√© de N\'Djam√©na',4.1,6)">
        <div class="recent-icon">üéì</div>
        <div style="flex:1">
          <div class="recent-name">Universit√© de N'Djam√©na</div>
          <div class="recent-meta">Lun 23 f√©v ‚Ä¢ 4.1 km ‚Ä¢ Fatima</div>
        </div>
        <div style="text-align:right">
          <div class="recent-price">1 450F</div>
          <div class="recent-arrow">‚Ä∫</div>
        </div>
      </div>
      <div class="recent-card" onclick="pick('H√¥pital G√©n√©ral',5.2,8)">
        <div class="recent-icon">üè•</div>
        <div style="flex:1">
          <div class="recent-name">H√¥pital G√©n√©ral</div>
          <div class="recent-meta">Dim 22 f√©v ‚Ä¢ 5.2 km ‚Ä¢ Ali</div>
        </div>
        <div style="text-align:right">
          <div class="recent-price">1 800F</div>
          <div class="recent-arrow">‚Ä∫</div>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-nav">
    <div class="nav-item on" onclick="nav(this);go('home')"><div class="nav-ico">üè†</div><div class="nav-lbl">Accueil</div></div>
    <div class="nav-item" onclick="nav(this);go('booking')"><div class="nav-ico">üöï</div><div class="nav-lbl">Commander</div></div>
    <div class="nav-item" onclick="nav(this)"><div class="nav-ico">üìã</div><div class="nav-lbl">Courses</div></div>
    <div class="nav-item" onclick="nav(this);go('profile')"><div class="nav-ico">üë§</div><div class="nav-lbl">Profil</div></div>
  </div>
</div>

<!-- ====== BOOKING ====== -->
<div class="screen" id="booking">
  <div class="booking-top">
    <button class="back-circle" onclick="go('home')">‚Üê</button>
    <div class="booking-inputs">
      <div class="b-inp-wrap">
        <div class="b-pip" style="background:var(--black)"></div>
        <input class="b-inp" type="text" value="Ma position actuelle" readonly style="color:var(--gray-400)">
      </div>
      <div class="b-inp-wrap">
        <div class="b-pip" style="background:var(--rouge)"></div>
        <input class="b-inp" type="text" id="destInp" placeholder="Destination..." autofocus>
      </div>
    </div>
  </div>
  <div class="booking-scroll">
    <div class="sugg-head">Suggestions</div>
    <div class="sugg-item" onclick="pick('A√©roport Hassan Djamous',8.2,12)"><div class="sugg-ico">‚úàÔ∏è</div><div><div class="sugg-name">A√©roport Hassan Djamous</div><div class="sugg-sub">N'Djam√©na International</div></div><div class="sugg-km">8.2 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('Universit√© de N\'Djam√©na',4.1,6)"><div class="sugg-ico">üéì</div><div><div class="sugg-name">Universit√© de N'Djam√©na</div><div class="sugg-sub">Quartier Farcha</div></div><div class="sugg-km">4.1 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('H√¥pital G√©n√©ral de R√©f√©rence',5.2,8)"><div class="sugg-ico">üè•</div><div><div class="sugg-name">H√¥pital G√©n√©ral de R√©f√©rence</div><div class="sugg-sub">Centre-ville</div></div><div class="sugg-km">5.2 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('March√© de Demb√©',3.8,6)"><div class="sugg-ico">üõí</div><div><div class="sugg-name">March√© de Demb√©</div><div class="sugg-sub">Demb√©</div></div><div class="sugg-km">3.8 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('Pr√©fecture de N\'Djam√©na',2.8,4)"><div class="sugg-ico">üèõÔ∏è</div><div><div class="sugg-name">Pr√©fecture de N'Djam√©na</div><div class="sugg-sub">Centre administratif</div></div><div class="sugg-km">2.8 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('Quartier Moursal',2.5,4)"><div class="sugg-ico">üèòÔ∏è</div><div><div class="sugg-name">Quartier Moursal</div><div class="sugg-sub">N'Djam√©na</div></div><div class="sugg-km">2.5 km</div></div>
    <div class="sugg-div"></div>
    <div class="sugg-item" onclick="pick('Grand March√© de N\'Djam√©na',1.8,3)"><div class="sugg-ico">üè™</div><div><div class="sugg-name">Grand March√©</div><div class="sugg-sub">Centre-ville</div></div><div class="sugg-km">1.8 km</div></div>
  </div>
</div>

<!-- ====== VEHICLES ====== -->
<div class="screen" id="vehicles">
  <div class="vehicle-map">
    <canvas id="vMapC"></canvas>
    <div class="vehicle-dest-label" id="vDestLbl">Destination</div>
    <button class="back-circle" style="position:absolute;top:12px;left:12px;background:rgba(255,255,255,0.9)" onclick="go('booking')">‚Üê</button>
  </div>
  <div class="vehicles-scroll">
    <div class="vehicle-card sel" id="vc0" onclick="selV(this,0)">
      <div class="v-emoji">üõµ</div>
      <div class="v-info"><div class="v-name">Moto Express</div><div class="v-desc">Rapide ¬∑ 1 personne</div><div class="v-eta" id="ve0">‚è± 3 min</div></div>
      <div class="v-right"><div class="v-price" id="vp0">500</div><div class="v-fcfa">FCFA</div></div>
    </div>
    <div class="vehicle-card" id="vc1" onclick="selV(this,1)">
      <div class="v-emoji">üöï</div>
      <div class="v-info"><div class="v-name">Yala Taxi</div><div class="v-desc">Confort ¬∑ 1‚Äì4 personnes</div><div class="v-eta" id="ve1">‚è± 5 min</div></div>
      <div class="v-right"><div class="v-price" id="vp1">1 200</div><div class="v-fcfa">FCFA</div></div>
    </div>
    <div class="vehicle-card" id="vc2" onclick="selV(this,2)">
      <div class="v-emoji">üöê</div>
      <div class="v-info"><div class="v-name">Yala Premium</div><div class="v-desc">Climatis√© ¬∑ 1‚Äì6 personnes</div><div class="v-eta" id="ve2">‚è± 8 min</div></div>
      <div class="v-right"><div class="v-price" id="vp2">2 500</div><div class="v-fcfa">FCFA</div></div>
    </div>
  </div>
  <div class="v-confirm">
    <div class="v-confirm-row">
      <div class="v-confirm-lbl">üí≥ Total estim√©</div>
      <div class="v-confirm-val" id="vTotal">500 FCFA</div>
    </div>
    <button class="btn-cta" onclick="doConfirm()">Commander maintenant ‚Üí</button>
  </div>
</div>

<!-- ====== TRACKING ====== -->
<div class="screen" id="tracking">
  <div class="track-map"><canvas id="tMapC"></canvas></div>
  <div class="track-sheet">
    <div class="track-handle"></div>
    <div class="track-status">
      <div class="track-status-title" id="tTitle">Chauffeur en route</div>
      <div class="track-status-sub" id="tSub">Arrive dans quelques minutes...</div>
    </div>
    <div class="track-eta-row">
      <div class="track-eta-box"><div class="track-eta-num" id="tMin">5</div><div class="track-eta-lbl">Minutes</div></div>
      <div class="track-eta-box"><div class="track-eta-num" id="tKm">‚Äî</div><div class="track-eta-lbl">Km</div></div>
      <div class="track-eta-box"><div class="track-eta-num" id="tPrix">‚Äî</div><div class="track-eta-lbl">FCFA</div></div>
    </div>
    <div class="track-prog"><div class="track-prog-fill" id="tProg" style="width:0%"></div></div>
    <div class="driver-block">
      <div class="driver-ava" id="dAva">üë®üèø</div>
      <div>
        <div class="driver-n" id="dName">Mahamat Ibrahim</div>
        <div class="driver-car-info" id="dCar">Toyota Corolla</div>
        <div class="driver-pl" id="dPlate">TD-2847-A</div>
      </div>
      <div class="driver-rating">
        <div class="driver-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <div class="driver-num" id="dRat">4.9</div>
      </div>
    </div>
    <div class="track-btns">
      <button class="btn-outline" onclick="callDrv()">üìû Appeler</button>
      <button class="btn-outline danger" onclick="cancelRide()">‚úï Annuler</button>
    </div>
  </div>
</div>

<!-- ====== ARRIVED ====== -->
<div class="screen" id="arrived">
  <div class="arrived-anim">üéâ</div>
  <div class="arrived-h">Vous √™tes arriv√© !</div>
  <div class="arrived-s" id="arrivedSub">Course avec Mahamat Ibrahim</div>
  <div class="price-big" id="arrivedAmt">1 200</div>
  <div class="price-curr">FCFA √† payer</div>
  <div class="rate-section">
    <div class="rate-label">Notez votre chauffeur</div>
    <div class="rate-stars">
      <div class="rate-star on" onclick="rate(1)">‚òÖ</div>
      <div class="rate-star on" onclick="rate(2)">‚òÖ</div>
      <div class="rate-star on" onclick="rate(3)">‚òÖ</div>
      <div class="rate-star on" onclick="rate(4)">‚òÖ</div>
      <div class="rate-star on" onclick="rate(5)">‚òÖ</div>
    </div>
  </div>
  <div class="pay-row">
    <div class="pay-btn on" onclick="selPay(this)"><div class="p-ico">üíµ</div><div class="p-lbl">Esp√®ces</div></div>
    <div class="pay-btn" onclick="selPay(this)"><div class="p-ico">üì±</div><div class="p-lbl">Airtel</div></div>
    <div class="pay-btn" onclick="selPay(this)"><div class="p-ico">üí≥</div><div class="p-lbl">Moov</div></div>
  </div>
  <button class="btn-cta green" onclick="doPay()" style="width:100%;margin-top:auto">‚úÖ Confirmer le paiement</button>
</div>

<!-- ====== PROFILE ====== -->
<div class="screen" id="profile">
  <div class="profile-top">
    <div class="profile-ava-big" id="profAva">M</div>
    <div class="profile-n" id="profName">Mon Profil</div>
    <div class="profile-p" id="profPhone">+235 --</div>
  </div>
  <div class="stats-row">
    <div class="stat-card"><div class="stat-n">8</div><div class="stat-l">Courses</div></div>
    <div class="stat-card"><div class="stat-n">4.9</div><div class="stat-l">Ma note</div></div>
    <div class="stat-card"><div class="stat-n">32km</div><div class="stat-l">Distance</div></div>
  </div>
  <div class="menu-grp">
    <div class="menu-grp-title">Mon compte</div>
    <div class="menu-row"><div class="menu-ico">üë§</div><div class="menu-lbl">Informations personnelles</div><div class="menu-chev">‚Ä∫</div></div>
    <div class="menu-row"><div class="menu-ico">üí≥</div><div class="menu-lbl">Modes de paiement</div><div class="menu-chev">‚Ä∫</div></div>
    <div class="menu-row"><div class="menu-ico">üìã</div><div class="menu-lbl">Historique des courses</div><div class="menu-chev">‚Ä∫</div></div>
    <div class="menu-row"><div class="menu-ico">üéÅ</div><div class="menu-lbl">Mes promotions</div><div class="menu-chev">‚Ä∫</div></div>
  </div>
  <div class="menu-grp">
    <div class="menu-grp-title">Support</div>
    <div class="menu-row"><div class="menu-ico">üÜò</div><div class="menu-lbl">Centre d'aide</div><div class="menu-chev">‚Ä∫</div></div>
    <div class="menu-row"><div class="menu-ico">‚≠ê</div><div class="menu-lbl">Noter l'application</div><div class="menu-chev">‚Ä∫</div></div>
  </div>
  <div class="menu-grp">
    <div class="menu-row danger" onclick="doLogout()"><div class="menu-ico">üö™</div><div class="menu-lbl">Se d√©connecter</div></div>
  </div>
  <div class="bottom-nav">
    <div class="nav-item" onclick="nav(this);go('home')"><div class="nav-ico">üè†</div><div class="nav-lbl">Accueil</div></div>
    <div class="nav-item" onclick="nav(this);go('booking')"><div class="nav-ico">üöï</div><div class="nav-lbl">Commander</div></div>
    <div class="nav-item" onclick="nav(this)"><div class="nav-ico">üìã</div><div class="nav-lbl">Courses</div></div>
    <div class="nav-item on" onclick="nav(this)"><div class="nav-ico">üë§</div><div class="nav-lbl">Profil</div></div>
  </div>
</div>

<script>
const API='http://localhost:5000/api';
const DRVS=[
  {n:'Mahamat Ibrahim',e:'üë®üèø',r:4.9,c:'Toyota Corolla',p:'TD-2847-A'},
  {n:'Fatima Oumar',   e:'üë©üèø',r:4.8,c:'Nissan Sunny',  p:'TD-1234-B'},
  {n:'Ibrahim Hassan', e:'üë®üèø‚Äçü¶±',r:4.7,c:'Peugeot 504',  p:'TD-5678-C'},
  {n:'Ali Mahamat',    e:'üë®üèø',r:4.6,c:'Toyota Hilux', p:'TD-9012-D'},
];
let user=null,destN='',destKm=0,destEta=0,selVeh=0,selPrice=500,drv=null;
let pInv=null,eInv=null,etaS=0,destPt=null;
const prices=[
  (km)=>Math.round((200+km*150)/50)*50,
  (km)=>Math.round((500+km*300)/50)*50,
  (km)=>Math.round((1000+km*500)/50)*50,
];
const etaMins=[0,0,3];

// ===== SCREENS =====
function go(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('show'));
  document.getElementById(id).classList.add('show');
  if(id==='vehicles') startVMap();
  if(id==='tracking') startTMap();
}
function nav(el){
  el.closest('.bottom-nav').querySelectorAll('.nav-item').forEach(n=>n.classList.remove('on'));
  el.classList.add('on');
}

// ===== SPLASH =====
setTimeout(()=>{
  const u=localStorage.getItem('yala_u');
  if(u){ user=JSON.parse(u); applyUser(); go('home'); }
  else go('login');
},3000);

// ===== AUTH =====
let savedOTP='',savedPhone='';
async function doSendOTP(){
  const p=document.getElementById('ph').value.trim();
  if(p.length<8){toast('Num√©ro invalide','red');return;}
  savedPhone='+235'+p;
  try{
    const r=await fetch(API+'/auth/send-otp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone:savedPhone})});
    const d=await r.json();
    savedOTP=d.debug_otp||'';
    document.getElementById('phDisp').textContent=savedPhone;
    if(savedOTP) savedOTP.split('').forEach((c,i)=>{const b=document.getElementById('o'+i);if(b){b.value=c;b.classList.add('done');}});
    document.getElementById('s1').style.display='none';
    document.getElementById('s2').style.display='block';
    toast('Code envoy√© !','green');
  }catch(e){toast('Erreur r√©seau','red');}
}
function otpIn(el,i){
  if(el.value){el.classList.add('done');if(i<5)document.getElementById('o'+(i+1)).focus();}
  else el.classList.remove('done');
}
async function doVerifyOTP(){
  const otp=[0,1,2,3,4,5].map(i=>document.getElementById('o'+i).value).join('');
  if(otp.length<6){toast('Entrez le code complet','red');return;}
  try{
    const r=await fetch(API+'/auth/verify-otp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone:savedPhone,otp,name:'Utilisateur',role:'passager'})});
    const d=await r.json();
    if(r.ok){user=d.user;localStorage.setItem('yala_u',JSON.stringify(user));applyUser();toast('Bienvenue !','green');go('home');}
    else toast('Code incorrect','red');
  }catch(e){toast('Erreur','red');}
}
function applyUser(){
  if(!user)return;
  const n=user.name||'Moi';
  document.getElementById('profName').textContent=n;
  document.getElementById('profPhone').textContent=user.phone||'';
  document.getElementById('greetTxt').textContent='Bonjour, '+n.split(' ')[0]+' üëã';
  document.getElementById('avatarBtn').textContent=n[0]||'M';
  document.getElementById('profAva').textContent=n[0]||'M';
}
function doLogout(){
  localStorage.removeItem('yala_u');user=null;
  document.getElementById('s1').style.display='block';
  document.getElementById('s2').style.display='none';
  go('login');
}

// ===== PICK DESTINATION =====
function pick(name,km,eta){
  destN=name;destKm=km;destEta=eta;
  destPt={px:0.5+(Math.random()-0.5)*0.4,py:0.5+(Math.random()-0.5)*0.4};
  document.getElementById('vDestLbl').textContent='‚Üí '+name;
  const lbls=['Moto','Taxi','Premium'];
  [0,1,2].forEach(i=>{
    const p=prices[i](km);
    document.getElementById('vp'+i).textContent=p.toLocaleString();
    document.getElementById('ve'+i).textContent='‚è± '+[Math.max(2,eta-2),eta,eta+3][i]+' min';
  });
  selV(document.getElementById('vc0'),0);
  go('vehicles');
}

// ===== SELECT VEHICLE =====
function selV(el,i){
  document.querySelectorAll('.vehicle-card').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
  selVeh=i;
  selPrice=prices[i](destKm);
  document.getElementById('vTotal').textContent=selPrice.toLocaleString()+' FCFA';
  document.getElementById('tPrix').textContent=selPrice.toLocaleString();
  document.getElementById('arrivedAmt').textContent=selPrice.toLocaleString();
}

// ===== CONFIRM RIDE =====
async function doConfirm(){
  drv=DRVS[Math.floor(Math.random()*DRVS.length)];
  document.getElementById('dAva').textContent=drv.e;
  document.getElementById('dName').textContent=drv.n;
  document.getElementById('dCar').textContent=drv.c;
  document.getElementById('dPlate').textContent=drv.p;
  document.getElementById('dRat').textContent=drv.r;
  document.getElementById('arrivedSub').textContent='Course avec '+drv.n;
  document.getElementById('tKm').textContent=destKm;
  document.getElementById('tMin').textContent=destEta;
  go('tracking');
  toast(drv.e+' '+drv.n+' est en route !','green');
  try{await fetch(API+'/rides/request',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({passenger_id:user?.id||1,pickup_lat:12.1048,pickup_lng:15.0445,pickup_address:'March√© Central',dropoff_lat:12.1348,dropoff_lng:15.0645,dropoff_address:destN,vehicle_type:['moto','taxi','premium'][selVeh]})});}catch(e){}
  startRide();
}
function startRide(){
  let s=0,total=80;etaS=destEta*60;
  eInv=setInterval(()=>{etaS=Math.max(0,etaS-1);const m=Math.floor(etaS/60);document.getElementById('tMin').textContent=m;},1000);
  pInv=setInterval(()=>{
    s++;const t=s/total;
    document.getElementById('tProg').style.width=(t*100)+'%';
    document.getElementById('tTitle').textContent=t<0.3?'Chauffeur en route':t<0.7?'üöï S\'approche...':t<0.95?'‚ö° Presque l√† !':'‚úÖ Chauffeur arriv√© !';
    document.getElementById('tSub').textContent=Math.round((1-t)*destKm*10)/10+' km restants';
    if(s>=total){clearInterval(pInv);clearInterval(eInv);setTimeout(()=>go('arrived'),800);}
  },180);
}
function callDrv(){if(drv)toast('üìû Appel de '+drv.n+'...');}
function cancelRide(){clearInterval(pInv);clearInterval(eInv);go('home');toast('Course annul√©e');}

// ===== ARRIVED =====
function rate(n){document.querySelectorAll('.rate-star').forEach((s,i)=>s.classList.toggle('on',i<n));}
function selPay(el){document.querySelectorAll('.pay-btn').forEach(b=>b.classList.remove('on'));el.classList.add('on');}
function doPay(){toast('‚úÖ Paiement de '+selPrice.toLocaleString()+' FCFA confirm√© !','green');setTimeout(()=>go('home'),2000);}

// ===== MAPS =====
const dPos=[{x:0.3,y:0.35},{x:0.7,y:0.55},{x:0.2,y:0.65},{x:0.75,y:0.25}];
const dVel=dPos.map(()=>({dx:(Math.random()-0.5)*0.002,dy:(Math.random()-0.5)*0.002}));
let vMapInt=null,tMapInt=null;

function drawMapOn(canvas){
  if(!canvas)return;
  const W=canvas.offsetWidth||300,H=canvas.offsetHeight||200;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  const g=ctx.createLinearGradient(0,0,W,H);
  g.addColorStop(0,'#0a0f1e');g.addColorStop(1,'#050810');
  ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  // Grid
  ctx.strokeStyle='rgba(255,255,255,0.03)';ctx.lineWidth=1;
  for(let i=0;i<20;i++){ctx.beginPath();ctx.moveTo(i*W/20,0);ctx.lineTo(i*W/20,H);ctx.stroke();ctx.beginPath();ctx.moveTo(0,i*H/20);ctx.lineTo(W,i*H/20);ctx.stroke();}
  // River
  ctx.beginPath();ctx.moveTo(0,H*0.62);ctx.bezierCurveTo(W*0.3,H*0.52,W*0.6,H*0.64,W,H*0.5);
  ctx.strokeStyle='rgba(30,100,220,0.2)';ctx.lineWidth=18;ctx.stroke();
  // Roads
  [[0,0.5,1,0.5,6],[0.5,0,0.5,1,6],[0,0.3,1,0.3,3],[0.3,0,0.3,1,3],[0.7,0,0.7,1,3]].forEach(([x1,y1,x2,y2,w])=>{
    ctx.beginPath();ctx.moveTo(x1*W,y1*H);ctx.lineTo(x2*W,y2*H);
    ctx.strokeStyle='rgba(255,255,255,0.1)';ctx.lineWidth=w;ctx.stroke();
  });
  // Route line
  if(destPt){
    ctx.beginPath();ctx.moveTo(0.5*W,0.5*H);ctx.lineTo(destPt.px*W,destPt.py*H);
    ctx.strokeStyle='rgba(200,16,46,0.6)';ctx.lineWidth=3;ctx.stroke();
    ctx.font='18px serif';ctx.textAlign='center';ctx.fillText('üìç',destPt.px*W,destPt.py*H+4);
  }
  // Taxis
  dPos.forEach((d,i)=>{
    d.x+=dVel[i].dx;d.y+=dVel[i].dy;
    if(d.x<0.05||d.x>0.92)dVel[i].dx*=-1;
    if(d.y<0.06||d.y>0.88)dVel[i].dy*=-1;
    const px=d.x*W,py=d.y*H;
    ctx.beginPath();ctx.arc(px,py,12,0,Math.PI*2);ctx.fillStyle='rgba(255,199,44,0.12)';ctx.fill();
    ctx.font='14px serif';ctx.textAlign='center';ctx.fillText('üöï',px,py+5);
  });
  // User dot (blue)
  const ux=0.5*W,uy=0.5*H;
  ctx.beginPath();ctx.arc(ux,uy,14,0,Math.PI*2);ctx.fillStyle='rgba(66,133,244,0.15)';ctx.fill();
  ctx.beginPath();ctx.arc(ux,uy,9,0,Math.PI*2);ctx.fillStyle='white';ctx.fill();
  ctx.beginPath();ctx.arc(ux,uy,7,0,Math.PI*2);ctx.fillStyle='#4285F4';ctx.fill();
}

function startVMap(){clearInterval(vMapInt);vMapInt=setInterval(()=>drawMapOn(document.getElementById('vMapC')),120);}
function startTMap(){clearInterval(tMapInt);tMapInt=setInterval(()=>drawMapOn(document.getElementById('tMapC')),120);}

// ===== TOAST =====
function toast(msg,type=''){
  const el=document.getElementById('t');
  el.textContent=msg;el.className='toast on'+(type?' '+type:'');
  setTimeout(()=>el.classList.remove('on'),3200);
}
</script>
</body>
</html>