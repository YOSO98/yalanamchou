<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paiement - Yalanamchou</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--rouge:#C8102E;--jaune:#FFC72C;--noir:#0A0A0F;--blanc:#F5F0E8;--vert:#22C55E}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--noir);color:var(--blanc);min-height:100vh}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;background:rgba(10,10,15,0.95);border-bottom:1px solid rgba(245,240,232,0.06)}
.topbar-logo{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:2px;background:linear-gradient(135deg,var(--jaune),var(--rouge));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.back-btn{background:rgba(245,240,232,0.08);border:none;color:var(--blanc);width:40px;height:40px;border-radius:12px;cursor:pointer;font-size:18px}
.content{padding:24px;max-width:420px;margin:0 auto}
.amount-card{background:linear-gradient(135deg,rgba(200,16,46,0.2),rgba(255,199,44,0.1));border:1px solid rgba(255,199,44,0.2);border-radius:24px;padding:32px;text-align:center;margin-bottom:28px}
.amount-label{font-size:13px;color:rgba(245,240,232,0.5);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.amount-value{font-family:'Bebas Neue',sans-serif;font-size:64px;color:var(--jaune);line-height:1}
.amount-sub{font-size:14px;color:rgba(245,240,232,0.4);margin-top:8px}
.ride-recap{background:rgba(245,240,232,0.04);border:1px solid rgba(245,240,232,0.08);border-radius:16px;padding:18px;margin-bottom:24px}
.recap-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(245,240,232,0.06);font-size:14px}
.recap-row:last-child{border:none}
.recap-row span:last-child{color:rgba(245,240,232,0.6)}
.section-title{font-size:15px;font-weight:700;margin-bottom:14px;color:rgba(245,240,232,0.7);text-transform:uppercase;letter-spacing:1px}
.methods{display:flex;flex-direction:column;gap:12px;margin-bottom:28px}
.method-card{display:flex;align-items:center;gap:16px;background:rgba(245,240,232,0.04);border:2px solid rgba(245,240,232,0.08);border-radius:18px;padding:18px;cursor:pointer;transition:all 0.3s}
.method-card:hover{border-color:rgba(255,199,44,0.3)}
.method-card.selected{border-color:var(--jaune);background:rgba(255,199,44,0.08)}
.method-icon{font-size:36px;flex-shrink:0}
.method-info h4{font-size:16px;font-weight:700}
.method-info p{font-size:13px;color:rgba(245,240,232,0.4);margin-top:3px}
.method-check{margin-left:auto;width:24px;height:24px;border-radius:50%;border:2px solid rgba(245,240,232,0.2);display:flex;align-items:center;justify-content:center;font-size:14px;transition:all 0.3s}
.method-card.selected .method-check{background:var(--jaune);border-color:var(--jaune);color:var(--noir)}
.phone-input{display:none;margin-top:12px}
.phone-input.show{display:block}
.input-field{width:100%;background:rgba(245,240,232,0.06);border:1px solid rgba(245,240,232,0.12);border-radius:14px;padding:16px 18px;color:var(--blanc);font-family:'Outfit',sans-serif;font-size:16px;outline:none;margin-top:8px}
.input-field:focus{border-color:var(--jaune)}
.input-field::placeholder{color:rgba(245,240,232,0.3)}
.btn{padding:18px;border-radius:16px;font-family:'Outfit',sans-serif;font-size:17px;font-weight:700;cursor:pointer;border:none;transition:all 0.3s;width:100%}
.btn-pay{background:linear-gradient(135deg,var(--vert),#16A34A);color:white;box-shadow:0 8px 30px rgba(34,197,94,0.3)}
.btn-pay:hover{transform:translateY(-2px);box-shadow:0 12px 40px rgba(34,197,94,0.4)}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(34,197,94,0.9);color:white;padding:14px 28px;border-radius:16px;font-weight:600;font-size:14px;z-index:999;transition:all 0.4s;white-space:nowrap}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.error{background:rgba(200,16,46,0.9)}
.success-screen{display:none;text-align:center;padding:48px 24px}
.success-screen.show{display:block;animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
.success-icon{font-size:80px;margin-bottom:24px;display:block}
.success-screen h2{font-size:28px;font-weight:800;margin-bottom:12px}
.success-screen p{font-size:15px;color:rgba(245,240,232,0.5);margin-bottom:32px}
.txn-badge{display:inline-block;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);border-radius:12px;padding:10px 20px;font-size:14px;color:#6BFF9E;font-weight:600;margin-bottom:32px}
.btn-home{background:rgba(245,240,232,0.08);color:var(--blanc);border:1px solid rgba(245,240,232,0.15)}
</style>
</head>
<body>
<div class="toast" id="toast"></div>

<div id="mainView">
  <div class="topbar">
    <button class="back-btn" onclick="history.back()">‚Üê</button>
    <div class="topbar-logo">PAIEMENT</div>
    <div style="width:40px"></div>
  </div>
  <div class="content">
    <div class="amount-card">
      <div class="amount-label">Montant a payer</div>
      <div class="amount-value" id="displayAmount">1 700</div>
      <div class="amount-sub">FCFA ‚Ä¢ Course #<span id="displayRide">1</span></div>
    </div>
    <div class="ride-recap">
      <div class="recap-row"><span>Trajet</span><span>Marche ‚Üí Aeroport</span></div>
      <div class="recap-row"><span>Distance</span><span>4 km</span></div>
      <div class="recap-row"><span>Commission</span><span id="commission">255 FCFA</span></div>
      <div class="recap-row"><span>Gain chauffeur</span><span id="gain" style="color:#6BFF9E">1 445 FCFA</span></div>
    </div>
    <div class="section-title">Mode de paiement</div>
    <div class="methods">
      <div class="method-card" onclick="selectMethod(this,'airtel_money')">
        <div class="method-icon">üì±</div>
        <div class="method-info">
          <h4>Airtel Money</h4>
          <p>Paiement instantane par SMS</p>
        </div>
        <div class="method-check">‚úì</div>
      </div>
      <div class="method-card" onclick="selectMethod(this,'moov_money')">
        <div class="method-icon">üí≥</div>
        <div class="method-info">
          <h4>Moov Money</h4>
          <p>Paiement instantane par SMS</p>
        </div>
        <div class="method-check">‚úì</div>
      </div>
      <div class="method-card selected" onclick="selectMethod(this,'cash')">
        <div class="method-icon">üíµ</div>
        <div class="method-info">
          <h4>Especes</h4>
          <p>Payer directement au chauffeur</p>
        </div>
        <div class="method-check" style="background:var(--jaune);border-color:var(--jaune);color:#000">‚úì</div>
      </div>
    </div>
    <div class="phone-input" id="phoneInput">
      <div style="font-size:14px;color:rgba(245,240,232,0.5)">Numero Mobile Money</div>
      <input type="tel" class="input-field" id="phoneField" placeholder="+235 66 XX XX XX">
    </div>
    <div style="height:20px"></div>
    <button class="btn btn-pay" onclick="payNow()">‚úÖ Payer maintenant</button>
    <div style="height:32px"></div>
  </div>
</div>

<div class="success-screen" id="successView">
  <span class="success-icon">üéâ</span>
  <h2>Paiement confirme !</h2>
  <p>Votre course a ete payee avec succes</p>
  <div class="txn-badge" id="txnBadge">Transaction: YNA-XXXXXXXX</div>
  <button class="btn btn-pay" style="margin-bottom:12px" onclick="window.location.href='/'">üè† Retour accueil</button>
  <button class="btn btn-home" onclick="window.location.href='/chauffeur'">üöï Tableau chauffeur</button>
</div>

<script>
const API = 'http://localhost:5000/api';
let selectedPayMethod = 'cash';
let rideId = 1;
let amount = 1700;

const params = new URLSearchParams(window.location.search);
if(params.get('ride_id')) rideId = params.get('ride_id');
if(params.get('amount')) {
  amount = parseInt(params.get('amount'));
  document.getElementById('displayAmount').textContent = amount.toLocaleString();
  document.getElementById('displayRide').textContent = rideId;
  const commission = Math.floor(amount * 0.15);
  document.getElementById('commission').textContent = commission.toLocaleString() + ' FCFA';
  document.getElementById('gain').textContent = (amount - commission).toLocaleString() + ' FCFA';
}

function toast(msg, isError=false){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className='toast show'+(isError?' error':'');
  setTimeout(()=>t.classList.remove('show'),3000);
}

function selectMethod(el, method){
  document.querySelectorAll('.method-card').forEach(c=>{
    c.classList.remove('selected');
    c.querySelector('.method-check').style.background='';
    c.querySelector('.method-check').style.borderColor='';
    c.querySelector('.method-check').style.color='';
  });
  el.classList.add('selected');
  el.querySelector('.method-check').style.background='var(--jaune)';
  el.querySelector('.method-check').style.borderColor='var(--jaune)';
  el.querySelector('.method-check').style.color='#000';
  selectedPayMethod = method;
  const phoneInput = document.getElementById('phoneInput');
  if(method === 'cash'){
    phoneInput.classList.remove('show');
  } else {
    phoneInput.classList.add('show');
    toast('Entrez votre numero ' + (method === 'airtel_money' ? 'Airtel' : 'Moov'));
  }
}

async function payNow(){
  const phone = document.getElementById('phoneField').value;
  if(selectedPayMethod !== 'cash' && !phone){
    return toast('Entrez votre numero Mobile Money', true);
  }
  try{
    const r = await fetch(API+'/payments/initiate', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        ride_id: rideId,
        user_id: 1,
        amount: amount,
        method: selectedPayMethod,
        phone: phone
      })
    });
    const d = await r.json();
    if(selectedPayMethod !== 'cash'){
      toast('SMS envoye sur le ' + phone + ' !');
      setTimeout(async () => {
        await fetch(API+'/payments/confirm/'+d.transaction_id, {method:'POST'});
        showSuccess(d.transaction_id);
      }, 2000);
    } else {
      showSuccess(d.transaction_id);
    }
  } catch(e){ toast('Erreur paiement', true); }
}

function showSuccess(txnId){
  document.getElementById('mainView').style.display = 'none';
  const s = document.getElementById('successView');
  s.classList.add('show');
  document.getElementById('txnBadge').textContent = 'Transaction: ' + txnId;
}
</script>
</body>
</html>